<!DOCTYPE html>
<html>
  <head>
<<<<<<< HEAD
    <title>NBA Player and Team Statistics</title>
=======
    <title>NBA Player Statistics</title>
>>>>>>> 2bfa62ba60d06db956d3d3953d8fea4124e72bd6
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='styles.css') }}"
    />
<<<<<<< HEAD
  </head>
  <body>
    <div class="container">
      <h1>Fresh Finder</h1>
      <h2>NBA Player Stats</h2>
      <div class="form-container">
        <form id="player-form">
          <label for="player-name">Enter Player Name:</label>
          <input
            type="text"
            id="player-name"
            name="player-name"
            placeholder="Player Name"
            required
          />
          <label for="start-date">Start date:</label>
          <input type="date" id="start-date" name="start-date" />
          <label for="end-date">End date:</label>
          <input type="date" id="end-date" name="end-date" />
          <input type="submit" value="Fetch Data" />
        </form>
      </div>

      <h2>NBA Player Stats Average</h2>
      <div class="form-container">
        <form id="player-average-form">
          <label for="player-average-name">Enter Player Name:</label>
          <input
            type="text"
            id="player-average-name"
            name="player-average-name"
            placeholder="Player Name"
            required
          />
          <label for="average-start-date">Start date:</label>
          <input
            type="date"
            id="average-start-date"
            name="average-start-date"
            required
          />
          <label for="average-end-date">End date:</label>
          <input
            type="date"
            id="average-end-date"
            name="average-end-date"
            required
          />
          <input type="submit" value="Fetch Average Stats" />
        </form>
      </div>

      <h2>NBA Team Search</h2>
      <div class="form-container">
        <form id="team-form" method="post" action="/team_search">
          <label for="team-name">Enter Team Name:</label>
          <input
            type="text"
            id="team-name"
            name="search_term"
            placeholder="Team Name"
            required
          />
          <input type="submit" value="Search Team" />
        </form>
      </div>

      <div class="table-container">
        <table id="stats-table">
          <tr>
            <th>Name</th>
            <th>Team For</th>
            <th>Team Against</th>
            <th>Minutes</th>
            <th>Points</th>
            <th>Rebounds</th>
            <th>Assists</th>
            <th>FG %</th>
            <th>TS %</th>
            <th>+/-</th>
          </tr>
        </table>
        <div id="no-matches" class="error" style="display: none">
          No matches played on this date
        </div>
        <div id="error-message" class="error" style="display: none"></div>
      </div>

      <div
        class="table-container"
        id="average-stats-container"
        style="display: none"
      >
        <h2>Average Stats</h2>
        <table>
          <tr>
            <th>Player Name</th>
            <th>Games Played</th>
            <th>Average Minutes</th>
            <th>Average Points</th>
            <th>Average Rebounds</th>
            <th>Average Assists</th>
            <th>Average FG %</th>
            <th>Average TS %</th>
            <th>Average +/-</th>
          </tr>
          <tr>
            <td id="average-player-name"></td>
            <td id="average-games-played"></td>
            <td id="average-minutes"></td>
            <td id="average-points"></td>
            <td id="average-rebounds"></td>
            <td id="average-assists"></td>
            <td id="average-fg-percent"></td>
            <td id="average-ts-percent"></td>
            <td id="average-plus-minus"></td>
          </tr>
        </table>
      </div>
    </div>

    <script>
      document.querySelector("#player-form").onsubmit = async function (event) {
        event.preventDefault();
        const playerName = document.querySelector("#player-name").value;
        const startDate = document.querySelector("#start-date").value;
        const endDate = document.querySelector("#end-date").value;
        try {
          const response = await fetch(
            `/player_stats?player_name=${playerName}&start_date=${startDate}&end_date=${endDate}`
          );
          if (!response.ok) {
            const errorData = await response.json();
            document.querySelector("#error-message").textContent =
              errorData.message || errorData.error;
            document.querySelector("#error-message").style.display = "block";
            document.querySelector("#no-matches").style.display = "none";
            document.querySelector("#stats-table").style.display = "none";
            return;
          }
          const stats = await response.json();
          displayStats(stats);
          document.querySelector("#error-message").style.display = "none";
        } catch (error) {
          console.error("Fetch error:", error);
          document.querySelector("#error-message").textContent =
            "Failed to fetch data. Please check the console for more information.";
          document.querySelector("#error-message").style.display = "block";
          document.querySelector("#no-matches").style.display = "none";
          document.querySelector("#stats-table").style.display = "none";
        }
      };

      function displayStats(stats) {
        const statsTable = document.querySelector("#stats-table");
        statsTable.innerHTML = `
                <tr>
                    <th>Name</th>
                    <th>Team For</th>
                    <th>Team Against</th>
                    <th>Minutes</th>
                    <th>Points</th>
                    <th>Rebounds</th>
                    <th>Assists</th>
                    <th>FG %</th>
                    <th>TS %</th>
                    <th>+/-</th>
                </tr>
            `;
        if (stats.length === 0) {
          document.querySelector("#no-matches").style.display = "block";
          statsTable.style.display = "none";
        } else {
          document.querySelector("#no-matches").style.display = "none";
          statsTable.style.display = "table";
          stats.forEach((stat) => {
            const row = statsTable.insertRow();
            const nameCell = row.insertCell(0);
            nameCell.innerHTML = `<a href="/player_profile/${encodeURIComponent(
              stat.name
            )}">${stat.name}</a>`;
            row.insertCell(
              1
            ).innerHTML = `<a href="/team_profile/${encodeURIComponent(
              stat.team_for
            )}"><img src="${stat.team_logo}" alt="${
              stat.team_for
            }" class="team-logo"> ${stat.team_for}</a>`;
            row.insertCell(
              2
            ).innerHTML = `<a href="/team_profile/${encodeURIComponent(
              stat.team_against
            )}"><img src="${stat.opposing_team_logo}" alt="${
              stat.team_against
            }" class="team-logo"> ${stat.team_against}</a>`;
            row.insertCell(3).textContent = stat.minutes;
            row.insertCell(4).textContent = stat.points;
            row.insertCell(5).textContent = stat.rebounds;
            row.insertCell(6).textContent = stat.assists;
            row.insertCell(7).textContent = stat.fg_percent.toFixed(2) + "%";
            row.insertCell(8).textContent = stat.ts_percent.toFixed(2) + "%";
            row.insertCell(
              9
            ).innerHTML = `<a href="/game_box_score/${stat.game_id}">${stat.plus_minus}</a>`;
          });
        }
      }

      document.querySelector("#player-average-form").onsubmit = async function (
        event
      ) {
        event.preventDefault();
        const playerName = document.querySelector("#player-average-name").value;
        const startDate = document.querySelector("#average-start-date").value;
        const endDate = document.querySelector("#average-end-date").value;
        try {
          const response = await fetch(
            `/player_stats_average?player_name=${playerName}&start_date=${startDate}&end_date=${endDate}`
          );
          if (!response.ok) {
            const errorData = await response.json();
            alert(errorData.message || errorData.error);
            return;
          }
          const averages = await response.json();
          displayAverageStats(averages);
        } catch (error) {
          console.error("Fetch error:", error);
          alert(
            "Failed to fetch data. Please check the console for more information."
          );
        }
      };

      function displayAverageStats(averages) {
        document.querySelector("#average-player-name").textContent =
          averages.player_name;
        document.querySelector("#average-games-played").textContent =
          averages.games_played;
        document.querySelector("#average-minutes").textContent =
          averages.average_minutes;
        document.querySelector("#average-points").textContent =
          averages.average_points;
        document.querySelector("#average-rebounds").textContent =
          averages.average_rebounds;
        document.querySelector("#average-assists").textContent =
          averages.average_assists;
        document.querySelector("#average-fg-percent").textContent =
          averages.average_fg_percent + "%";
        document.querySelector("#average-ts-percent").textContent =
          averages.average_ts_percent + "%";
        document.querySelector("#average-plus-minus").textContent =
          averages.average_plus_minus;

        document.querySelector("#average-stats-container").style.display =
          "block";
=======
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 20px;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      form {
        text-align: center;
        margin-bottom: 20px;
      }
      input[type="date"],
      input[type="text"] {
        padding: 10px;
        margin-right: 10px;
        font-size: 16px;
      }
      input[type="submit"] {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
      }
      table {
        width: 100%;
        margin: 20px auto;
        border-collapse: collapse;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
      }
      th,
      td {
        padding: 12px;
        background-color: #fff;
        border-bottom: 1px solid #ddd;
        text-align: left;
        cursor: pointer;
      }
      th {
        background-color: #4caf50;
        color: white;
      }
      tr:hover {
        background-color: #f1f1f1;
      }
      img.team-logo {
        height: 30px;
        vertical-align: middle;
        margin-left: 10px;
      }
      @media (max-width: 600px) {
        table {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <h1>NBA Player Stats</h1>
    <form id="data-form">
      <label for="start-date">Start date:</label>
      <input type="date" id="start-date" name="start-date" />
      <label for="end-date">End date:</label>
      <input type="date" id="end-date" name="end-date" />
      <label for="player-name">Search for a player:</label>
      <input
        type="text"
        id="player-name"
        name="player-name"
        placeholder="Player name"
      />
      <input type="submit" value="Fetch Data" />
    </form>
    <table id="stats-table">
      <tr>
        <th onclick="sortTable('name')">Name</th>
        <th onclick="sortTable('team')">Team</th>
        <th onclick="sortTable('opposing_team')">Opposing Team</th>
        <th onclick="sortTable('points_scored')">Points Scored</th>
        <th onclick="sortTable('assists')">Assists</th>
        <th onclick="sortTable('rebounds')">Rebounds</th>
        <th onclick="sortTable('field_goal_percentage')">Field Goal %</th>
        <th onclick="sortTable('true_shooting_percentage')">True Shooting %</th>
        <th onclick="sortTable('player_efficiency_rating')">PER</th>
      </tr>
    </table>
    <div id="no-matches" style="display: none">
      No matches played on this date
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      document.querySelector("#data-form").onsubmit = async function (event) {
        event.preventDefault();
        const startDate = document.querySelector("#start-date").value;
        const endDate = document.querySelector("#end-date").value;
        const playerName = document
          .querySelector("#player-name")
          .value.toLowerCase();
        try {
          const response = await fetch("/data", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              start_date: startDate,
              end_date: endDate,
              player_name: playerName,
            }),
          });
          if (!response.ok) {
            throw new Error(
              "Network response was not ok: " + response.statusText
            );
          }
          const data = await response.json();
          if (data.message) {
            document.querySelector("#no-matches").style.display = "block";
            document.querySelector("#stats-table").style.display = "none";
            return;
          } else {
            document.querySelector("#no-matches").style.display = "none";
            document.querySelector("#stats-table").style.display = "table";
          }
          const filteredData = playerName
            ? data.filter((player) =>
                player.name.toLowerCase().includes(playerName)
              )
            : data;
          populateTable(filteredData);
        } catch (error) {
          console.error("Fetch error:", error);
          alert(
            "Failed to fetch data. Please check the console for more information."
          );
        }
      };

      let sortOrder = {};

      function populateTable(data) {
        const table = document.querySelector("#stats-table");
        table.innerHTML = `
                <tr>
                    <th onclick="sortTable('name')">Name</th>
                    <th onclick="sortTable('team')">Team</th>
                    <th onclick="sortTable('opposing_team')">Opposing Team</th>
                    <th onclick="sortTable('points_scored')">Points Scored</th>
                    <th onclick="sortTable('assists')">Assists</th>
                    <th onclick="sortTable('rebounds')">Rebounds</th>
                    <th onclick="sortTable('field_goal_percentage')">Field Goal %</th>
                    <th onclick="sortTable('true_shooting_percentage')">True Shooting %</th>
                    <th onclick="sortTable('player_efficiency_rating')">PER</th>
                </tr>`;
        data.forEach((player) => {
          const row = table.insertRow();
          row.insertCell(0).textContent = player.name;
          const teamCell = row.insertCell(1);
          teamCell.innerHTML = `<img src="${player.team_logo}" alt="${player.team}" class="team-logo">${player.team}`;
          const opponentCell = row.insertCell(2);
          opponentCell.innerHTML = `<img src="${player.opposing_team_logo}" alt="${player.opposing_team}" class="team-logo">${player.opposing_team}`;
          row.insertCell(3).textContent = player.points_scored;
          row.insertCell(4).textContent = player.assists;
          row.insertCell(5).textContent = player.rebounds;
          row.insertCell(6).textContent =
            player.field_goal_percentage.toFixed(2) + "%";
          row.insertCell(7).textContent =
            player.true_shooting_percentage.toFixed(2) + "%";
          row.insertCell(8).textContent =
            player.player_efficiency_rating.toFixed(2);
        });
      }

      function sortTable(category) {
        const table = document.querySelector("#stats-table");
        const rows = Array.from(table.rows).slice(1);

        sortOrder[category] = sortOrder[category] === "asc" ? "desc" : "asc";

        rows.sort((a, b) => {
          const aVal = a.cells[
            {
              name: 0,
              team: 1,
              opposing_team: 2,
              points_scored: 3,
              assists: 4,
              rebounds: 5,
              field_goal_percentage: 6,
              true_shooting_percentage: 7,
              player_efficiency_rating: 8,
            }[category]
          ].textContent.replace("%", "");

          const bVal = b.cells[
            {
              name: 0,
              team: 1,
              opposing_team: 2,
              points_scored: 3,
              assists: 4,
              rebounds: 5,
              field_goal_percentage: 6,
              true_shooting_percentage: 7,
              player_efficiency_rating: 8,
            }[category]
          ].textContent.replace("%", "");

          if (!isNaN(parseFloat(aVal)) && !isNaN(parseFloat(bVal))) {
            return sortOrder[category] === "asc"
              ? parseFloat(aVal) - parseFloat(bVal)
              : parseFloat(bVal) - parseFloat(aVal);
          } else {
            return sortOrder[category] === "asc"
              ? aVal.localeCompare(bVal)
              : bVal.localeCompare(aVal);
          }
        });

        rows.forEach((row) => table.appendChild(row));
>>>>>>> 2bfa62ba60d06db956d3d3953d8fea4124e72bd6
      }
    </script>
  </body>
</html>
